《不可见莺（The Invisible Warbler）》三维交互艺术网页
【项目技术框架说明】

一、前端部分
----------------
1. 技术栈与核心库
   - **three.js（核心3D渲染引擎）**
     - GLTFLoader/GLB模型加载
     - 材质系统与PBR渲染
     - MatCap材质系统（陶瓷质感渲染）
     - 后期处理与着色器支持
     - ACES Tone Mapping（专业色彩映射）
   - React + react-three-fiber（如需响应式UI与组件化）
   - 状态管理：Zustand / MobX / Redux（胶卷、归档等全局数据）
   - Webpack（构建/模块化与热重载）
   - CSS (可选styled-components、Sass等)
   - **性能监控工具**：Stats.js、内存分析器

2. 主要目录结构
   /public        —— 静态资源与入口HTML
      |-- models/bird_components/   # GLB模型库（按部位分类）
         |-- head/                  # 头部模型
         |-- chest/                 # 胸部模型
         |-- belly/                 # 腹部模型
         |-- wing/                  # 翅膀模型
         |-- tail/                  # 尾部模型
         |-- foot/                  # 足部模型
   /src           —— 前端主源码目录
      |-- index.js                 # three.js主入口（简化版，专注模型显示）
      |-- components/              # 可复用ThreeJS与UI组件（待扩展）
      |-- modules/                 # 核心功能模块（待逐步添加）
         |-- glbLoader.js          # GLB模型加载器
         |-- birdComponentLibrary.js # 鸟类组件库管理
         |-- randomBird.js         # 鸟类生成器（GLB+几何体混合）
         |-- birdFragment.js       # 碎片生成模块
         |-- aiSynthesis.js        # AI合成模块
         |-- filmRollState.js      # 胶卷状态管理
      |-- performanceMonitor.js # 性能监控
      |-- pointCloudShader.js   # 点云着色器
      |-- steering.js           # 鸟类转向行为系统
      |-- pathUtils.js          # 路径生成与平滑算法
      |-- utils/                   # 工具函数/辅助逻辑
      |-- styles/                  # 样式相关

3. 重点功能模块
   - 魔幻丛林3D场景生成：程序化生态、灯光雾效、后处理
   - **GLB模型加载与预处理系统**：缓存、材质转换、居中缩放
   - **鸟类组件库管理系统**：按部位组织GLB组件，动态扫描加载
   - **混合鸟类生成器**：GLB组件 + 程序几何体fallback
   - 摄像头交互和鼠标拾取
   - 胶卷收集/拼贴机制与实时反馈
   - **超级组合体智能布局系统**：
     - 混合策略算法：head分布、chest螺旋、belly螺旋、尾部级联、翅膀螺旋、足部对称堆叠
     - 组件分组管理：componentGroups替代SLOT_ORDER，支持同类型部件自由组合
     - 策略映射系统：getBestStrategy()根据部位类型自动选择最佳排列策略
     - 实时参数调优：7个布局参数支持实时调整（分布半径、螺旋圈数、重力系数等）
   - **加载体验系统**：
     - 居中覆盖层：全屏半透明黑色背景，flexbox居中布局
     - 动态点点动画：JavaScript定时器循环更新点数量（""→"."→".."→"..."→""）
     - 智能显示控制：init()开始时显示，模型加载完成后自动隐藏
     - 错误处理：HDR/模型加载失败时显示友好提示，45秒超时保护
     - 内存管理：自动清理定时器和DOM元素
   - 专业展示页面：0.85黑灰背景、ACES tone mapping、OrbitControls交互
   - **UI层级管理系统**：
     - 绝对定位策略：position: absolute确保UI元素稳定位置
     - z-index层级管理：Clear Film按钮z-index: 3002确保顶层显示
     - 按钮间距优化：关闭按钮与Clear Film按钮间隔80px避免重合
   - **响应式布局系统**：
     - 自适应尺寸：预览框占90%屏幕空间，移除硬性尺寸限制
     - 动态布局：根据内容自动调整最佳显示比例
     - 空间优化：充分利用屏幕空间提供沉浸式3D预览体验
   - **MatCap材质渲染系统**：
     - matcap-porcelain-white材质球提供陶瓷质感
     - 智能材质转换：MeshMatcapMaterial自动迁移
     - 属性保持：颜色、贴图、法线贴图完整迁移
     - 视图相关照明：基于观察角度的材质效果
   - 风格（主义）伪AI归纳模块（无AI API，本地规则/伪随机）
   - 图鉴与归档展示页，支持3D预览与持久化
   - UI页面切换/动画/提示（可用React Router）
   - **性能监控与LOD系统**：高多边形模型优化、分级渲染

   - **Windows启动器系统**：
     - Invisible_Warbler.bat批处理文件：一键启动开发环境
     - 自动化流程：后台启动npm服务器，利用webpack-dev-server自动打开浏览器
     - 重复打开修复：避免webpack自动打开与手动打开的冲突
     - 时序控制：3秒等待时间确保服务器完全就绪
     - 用户反馈：清晰的启动状态信息和操作指导

   - **国际化文档系统**：
     - 双语README.md：英文优先、中文保留的双语文档结构
     - 英文LAUNCH_README.md：完整的英文启动器使用指南
     - 多语言用户支持：打破语言障碍，支持国际用户群体
     - 内容同步机制：确保中英文版本的信息一致性和完整性

   - **场景测试系统**：
     - indexscenetest.js：纯场景展示文件，移除所有鸟类和交互逻辑
     - 森林环境生成：90根程序化树枝 + 40条地面扭曲线条
     - HDR环境照明：环境贴图 + 多级光照系统 + 雾效果
     - 渲染优化：阴影映射 + ACES色调映射 + 抗锯齿
     - 调试控制：简化的轨道控制器 + 参数调节面板
     - 测试模型：5倍大小belly组件(belly (1).glb)，位置(0, 3, 0)
     - 天空渲染：大气散射天空(Preetham模型)，参数可调
     - 环境光照：Ocean风格PMREM环境照明 + 同步方向光照
     - 色调映射：8种算法(ACESFilmic/Custom) + 曝光/背景控制
     - 材质处理：全新的材质实例化方案，完全避免onBuild问题
     - 资源管理：自动清理PMREM生成器和环境贴图

   - **音量控制系统**：
     - 极简UI设计：垂直音量条 + 圆形静音按钮，移除视觉干扰元素
     - 智能状态显示：按钮图标基于实际音量动态切换（🔊/🔇）
     - 音量条交互：点击任意位置精确调节音量，支持0-100%范围
     - 状态同步：音量改变时自动更新按钮显示和条形填充
     - 记忆功能：静音时保存前一音量值，取消静音时恢复

   - **胶卷阈值优化系统**：
     - 即时预览：收集1个组件即可激活胶卷预览功能
     - 视觉反馈：0个时灰色禁用，1-9个蓝色激活，10+个金色高亮
     - 用户体验：降低操作门槛，提升交互流畅性和即时反馈

   - **场景亮度增强系统**：
     - 全局光照提升：所有光源强度统一+0.1（环境光0.4→0.5，主光0.8→0.9，填充光0.3→0.4）
     - 自然照明：模拟真实森林环境的光照层次和对比度
     - 视觉舒适度：提供更柔和、更明亮的观察体验

   - **音乐播放时机控制系统**：
     - 场景就绪后播放：等待所有模型加载完成和场景渲染就绪
     - 智能降级：优先自动播放，失败时等待用户首次交互
     - 音量预设：默认60%音量平衡体验和舒适度
     - 性能优化：避免加载过程中的音频干扰，提升用户体验

   - **预览页面交互增强系统**：
     - 右键拖拽支持：启用OrbitControls的pan功能，支持上下左右屏幕移动
     - 多模式控制：左键旋转 + 右键平移 + 滚轮缩放的完整3D导航
     - 操作指导：界面提示明确标注各种鼠标操作方式
     - 用户友好：灵活的视角控制，增强3D模型欣赏体验

4. 本地资源与模型管理
   - **主要采用GLB/GLTF模型**：存储在 /public/models/bird_components/ 按部位分类
   - 程序生成geometry作为fallback机制
   - **模型预处理**：材质标准化、包围盒计算、阴影设置
   - **组件库架构**：
     - head/：头部模型（多个变体）
     - chest/：胸部模型（核心组件）
     - belly/：腹部模型
     - wing/：翅膀模型（左右对称）
     - tail/：尾部模型
     - foot/：足部模型
   - 图片贴图、材质、声音等统一管理

5. 适配与优化
   - 移动/PC自适应，性能监控与降级策略
   - **GLB模型性能优化**：
     - 模型预加载与缓存机制
     - 高多边形模型LOD（细节层次）系统
     - 动态实例化减少draw calls
     - 材质压缩与纹理优化
   - **内存管理**：
     - GLB模型缓存池管理
     - 场景外模型自动卸载
     - 纹理压缩与内存监控

6. 交互系统
   - **长按选取系统**：
     - 3秒长按触发，射线检测鸟类组合体
     - SVG进度环顺时针补全动画
     - 移动取消阈值8px，防止误操作
   - **胶卷收集系统**：
     - Session内存存储，最多10个捕获
     - 离屏渲染生成256x256缩略图
     - 模态画廊预览系统
   - **组合体序列化**：
     - 提取partType、位置、旋转等组件数据
     - UUID唯一标识，时间戳记录
     - 动态重建预览功能

二、GLB模型系统架构
----------------
1. GLB模型加载器 (glbLoader.js)
   - 基于Three.js GLTFLoader
   - 缓存机制避免重复加载
   - 自动材质标准化（MeshStandardMaterial）
   - 模型居中与缩放预处理

2. 鸟类组件库 (birdComponentLibrary.js)
   - 按部位分类管理GLB模型
   - 文件夹扫描自动发现新模型
   - 随机组件选择API
   - 异步初始化支持

3. 混合生成策略
   - 优先使用GLB组件
   - 几何体fallback机制
   - **组件定位算法优化**：基于包围盒的动态对齐系统
     - 使用 THREE.Box3 计算各组件包围盒
     - 胸部作为基准参考点，其他部件相对定位
     - 智能间隙计算，确保部件紧密贴合
     - 翅膀和足部贴合度可调（当前设置为0.3m内收）
   - 对称翅膀/足部自动生成

4. **鸟类生命周期视觉效果系统**
   - **淡入动画引擎**：基于requestAnimationFrame的透明度插值系统
     - `animateOpacity()` 函数实现平滑透明度过渡
     - easeInOut缓动曲线提供自然视觉效果
     - 5秒持续时间，从透明(0)到完全可见(1)
   - **淡出动画引擎**：寿命结束时的优雅消失效果
     - 5秒持续时间，从完全可见(1)到透明(0)
     - 动画完成后自动从场景移除
   - **透明度控制函数**：`setObjectOpacity()` 递归处理多材质mesh
     - 支持Array材质和单材质对象
     - 自动设置 transparent = true 并应用 opacity 值
   - **生命周期管理**：集成到FlyingBird类和场景更新循环
     - 构造函数中自动启动淡入动画
     - updateFlyingBirds中检测寿命并启动淡出
     - 超级组合体组件豁免：强制opacity=1.0，transparent=false

5. **白盒子展示空间系统**
   - **封闭几何空间**：20x20x20米的纯白色立方体空间
     - 5个面围成完整封闭环境（地板、天花板、后墙、左墙、右墙）
     - 使用MeshLambertMaterial的白色材质
     - DoubleSide渲染确保内外可见
   - **专业光照配置**：多层次光照系统
     - 环境光 (0xffffff, 0.4) 提供基础照明
     - 主光源 (0xffffff, 0.8) 从右上角照射，支持阴影
     - 填充光 (0xffffff, 0.15) 使用HemisphereLight减少对比度
   - **材质对比增强**：白色背景突出MatCap材质细节效果
   - **专业展示模式**：类似3D建模软件的白盒预览环境
   - **软阴影系统**：PCFSoftShadowMap软阴影渲染
     - 模型投射和接收阴影
     - shadow.mapSize 2048x2048，shadow.radius = 4 控制柔和度
     - 阴影相机范围适配20m立方体空间

4. 性能优化策略
   - 模型预加载队列
   - 内存使用监控
   - 距离剔除（frustum culling）
   - 纹理压缩优化

二、（可选）后端部分
----------------
1. 作用：仅当需支持云端存储、AI云推理或协作功能时采用
2. 方案推荐：
   - Node.js（Koa/Nest/Express）或 FastAPI/Flask（Python）
   - 数据库：MongoDB / SQLite / 云数据库
   - 静态资源：OSS/CDN，有需时支持模型与图片上传
   - AI融合：如需后续AI自动生成图片/3D等作为API提供

三、开发和部署
----------------
- 本地开发：npm+webpack热重载
- 线上：静态托管+云资源、部署至Vercel、Netlify、阿里云OSS、Github Pages等
- 可按MVP分阶段上线，后续支持AI或多用户模块可即时扩展

// 该文件可作为团队技术沟通与分工参考

